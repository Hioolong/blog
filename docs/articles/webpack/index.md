---
title: Webpack æ ¸å¿ƒæµç¨‹åŠåŸç†
author: Ronney
date: '2023-04-27'
categories: 
- æ„å»º
tags:
- webpack
---

# Webpack æ ¸å¿ƒæµç¨‹åŠåŸç†

webpack æ˜¯ä¸€ä¸ªç°åœ¨ Javascript  åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’çš„æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸€ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–è€…å¤šä¸ª bundleã€‚

**æ ¸å¿ƒæµç¨‹**

webpack çš„è¿è¡Œæµç¨‹æ˜¯ä¸€ä¸ª**ä¸²è¡Œ**çš„è¿‡ç¨‹ï¼Œä»å¯åŠ¨åˆ°ç»“æŸä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š

1. åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„å‚æ•°ã€‚
2. å¼€å§‹ç¼–è¯‘ï¼šç”¨ä¸Šä¸€æ­¥è·å–çš„å‚æ•°åˆå§‹åŒ– `Compiler` å¯¹è±¡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ‰§è¡Œå¯¹è±¡çš„ `run` æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ã€‚
3. ç¡®å®šå…¥å£ï¼šæ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ã€‚
4. ç¼–è¯‘æ¨¡å—ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œç¿»è¯‘ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ã€‚
5. å®Œæˆæ¨¡å—ç¼–è¯‘ï¼šå¾—åˆ°æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„æœ€ç»ˆå†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
6. è¾“å‡ºèµ„æºï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunkï¼Œå†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ï¼Œè¿™ä¸€æ­¥æ˜¯æœ€åå¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœºä¼šã€‚
7. è¾“å‡ºå®Œæˆï¼šç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®çš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚

åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´èŠ‚ç‚¹å¹¿æ’­å‡ºç‰¹å®šçš„äº‹ä»¶ï¼Œæ’ä»¶åœ¨ç›‘å¬åˆ°äº‹ä»¶åä¼šæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¹¶ä¸”æ’ä»¶å¯ä»¥è°ƒç”¨ webpack æä¾›çš„ api æ”¹å˜è¿è¡Œç»“æœã€‚

## entryï¼ˆå…¥å£ï¼‰

å…¥å£å°±æ˜¯ webpack é€šè¿‡è¯¥èµ·ç‚¹æ‰¾åˆ°æœ¬é¡¹ç›®æ‰€ç›´æ¥æˆ–è€…é—´æ¥ä¾èµ–çš„èµ„æºï¼ˆæ¨¡å—ã€åº“ï¼‰ç­‰ï¼Œå¹¶ä¸”å¯¹å®ƒè¿›è¡Œå¤„ç†ï¼Œæœ€åè¾“å‡ºåˆ° `bundle` ä¸­ã€‚å…¥å£æ–‡ä»¶ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼Œæœ€åç”Ÿæˆå¯¹åº”çš„ `bundle`ã€‚

å¸¸è§åœºæ™¯ï¼šåˆ†ç¦» appï¼ˆåº”ç”¨ç¨‹åºï¼‰å’Œ vendorï¼ˆç¬¬ä¸‰æ–¹åº“ï¼‰å…¥å£
```javascript
module.exports = {
  entry: {
    main: './src/app.js',
    vendor: './src/vendor.js'
  }
}
```

## outputï¼ˆå‡ºå£ï¼‰

å¯ä»¥é€šè¿‡é…ç½® `output` é€‰é¡¹ï¼Œå‘Šè¯‰ webpack å¦‚ä½•å‘ç¡¬ç›˜å†™å…¥ç¼–è¯‘æ–‡ä»¶ã€‚æ³¨æ„ï¼šå³ä½¿å­˜åœ¨å¤šä¸ª `entry` èµ·ç‚¹ï¼Œä¹Ÿåªèƒ½æŒ‡å®šä¸€ä¸ª `output` é…ç½®ã€‚

> å¦‚æœé…ç½®ä¸­åˆ›å»ºå‡ºå¤šäºä¸€ä¸ª `chunk`ï¼ˆä¾‹å¦‚ï¼šä½¿ç”¨å¤šä¸ªå…¥å£èµ·ç‚¹æˆ–è€…ä½¿ç”¨ `CommonsChunkPlugin` æ¥æå–å…¬å…± `chunk`ï¼‰ï¼Œåˆ™åº”è¯¥ä½¿ç”¨å ä½ç¬¦æ¥ç¡®ä¿æ¯ä¸€ä¸ªæ–‡ä»¶å…·æœ‰å”¯ä¸€çš„åç§°ã€‚

```javascript
module.exports = {
  entry: {
    app: './src/app.js',
    search: './src/search.js'
  },
  output: {
    filename: '[name].js',
    path: __dirname + '/dist'
  }
}

// æœ€ç»ˆè¾“å‡ºï¼š ./dist/app.js, ./dist/search.js
```

## loaderï¼ˆåŠ è½½å™¨ï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œwebpack åªèƒ½å¤„ç† js æ–‡ä»¶ï¼Œæ‰€ä»¥å¯¹äºå›¾ç‰‡ã€cssã€tsã€vue ç­‰ç­‰å…¶ä»–ç±»å‹çš„é™æ€èµ„æºåˆ™éœ€è¦é€šè¿‡ loader æ¥å¤„ç†ï¼Œå®ƒèƒ½å°†å…¶ä»–èµ„æºè½¬åŒ–ä¸º js è¿›è¡Œå¤„ç†ã€‚

æœ‰äº† loaderï¼Œæˆ‘ä»¬èƒ½å®ç°å¾ˆå¤šåŠŸèƒ½ï¼Œå¦‚ï¼š

* å°†ä¸åŒçš„è¯­è¨€ï¼ˆTypescriptã€Vueï¼‰è½¬æ¢ä¸º Javascript
* å°†å›¾åƒè½¬æ¢ä¸º data URLï¼ˆbase64ï¼‰
* åœ¨ Javascript æ¨¡å—ä¸­ `import` CSS æ–‡ä»¶
* ä½¿ç”¨ CSS é¢„å¤„ç†å™¨ Sassã€Less ç­‰

å¸¸ç”¨ Loaders

* url-loader å¯ä»¥åŠ è½½èµ„æºï¼Œå°†å°ºå¯¸è¾ƒå°çš„æ–‡ä»¶è½¬æ¢ä¸º base64ç­‰
* babel-loader es6 è½¬ es5
* ts-loader ts è½¬æ¢æˆ js
* less-loader less è½¬æ¢æˆ css
* css-loader æ”¯æŒåœ¨ javascript ä¸­åŠ è½½ css
* style-loader å°† css æ–‡ä»¶æ³¨å…¥åˆ° html æ–‡æ¡£æ±‡æ€»
* vue-loader å°† vue sfc è½¬æ¢ä¸º js

ä¸€ä¸ª loader å®é™…ä¸Šæ˜¯ä¸€ä¸ªåœ¨ node.js ä¸‹è¿è¡Œçš„æ¨¡å—ï¼Œä¸€ä¸ªç®€å•çš„ loader æºç å¦‚ä¸‹æ‰€ç¤ºï¼š

```javascript
module.exports = function(source) {
  // source ä¸º compiler ä¼ é€’ç»™ loader çš„æ–‡ä»¶çš„åŸå†…å®¹
  // å¤„ç†å†…å®¹
  const formatSource = format(source)
  // éœ€è¦è¿”å›å¤„ç†åçš„å†…å®¹ï¼Œä¾›ä¸‹ä¸€ä¸ª loader ä½¿ç”¨
  return formatSource;
}
```


## pluginï¼ˆæ’ä»¶ï¼‰

webpack é€šè¿‡ plugin æœºåˆ¶ä½¿å…¶æ›´åŠ çµæ´»ï¼Œä»¥åº”å¯¹å„ç§åº”ç”¨åœºæ™¯ã€‚åœ¨ webpack çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¹¿æ’­å‡ºå¥½å¤šäº‹ä»¶ï¼Œplugin å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨ webpack æä¾›çš„ api æ”¹å˜è¾“å‡ºç»“æœã€‚

ä¸€ä¸ªåŸºç¡€çš„ plugin ä»£ç å¦‚ä¸‹ï¼š

```javascript
class BasicPlugin {
  constructor(options) {
    // options è·å–ç”¨æˆ·ä¼ ç»™æœ¬æ’ä»¶çš„é…ç½®
  }

  // webpack ä¼šè°ƒç”¨ BasicPlugin å®ä¾‹çš„ apply æ–¹æ³•ç»™æ’ä»¶å®ä¾‹ä¼ å…¥ compiler å¯¹è±¡
  apply(compiler) {
    // å¯ä»¥é€šè¿‡ compiler å¯¹è±¡æ³¨å†Œç›‘å¬å„ä¸ªç”Ÿå‘½å‘¨æœŸå¹¿æ’­å‡ºæ¥çš„äº‹ä»¶
    compiler.plugin('compilation', function(compilation) {
      // å¯ä»¥åœ¨æ­¤è°ƒç”¨ webpack æä¾›çš„ api æ”¹å˜è¾“å‡ºç»“æœ
    })
  }
}

module.exports = BasicPlugin;
```

ä½¿ç”¨æ­¤æ’ä»¶æ—¶ï¼Œç›¸å…³çš„é…ç½®ä»£ç å¦‚ä¸‹ï¼š

```javascript
const BasicPlugin = require('./BasicPlugin.js');
module.export = {
  plugins: [
    new BasicPlugin(options)
  ]
}
```

ç¼–å†™ plugin æœŸé—´ï¼Œæœ€å¸¸ç”¨çš„ä¸¤ä¸ªå¯¹è±¡å°±æ˜¯ `compiler` å’Œ `compilation`ï¼Œå®ƒä»¬æ˜¯ plugin å’Œ webpack ä¹‹é—´çš„æ¡¥æ¢ã€‚ä»–ä»¬çš„å«ä¹‰å¦‚ä¸‹

* compiler å¯¹è±¡åŒ…å«äº† webpack ç¯å¢ƒæ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…å« optionsã€loadersã€plugins è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ webpack å¯åŠ¨çš„æ—¶å€™è¢«å®ä¾‹åŒ–ï¼Œæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¯ä»¥ç®€å•æŠŠå®ƒç†è§£æˆ webpack çš„å®ä¾‹ã€‚
* compilation å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚å½“ webpack ä»¥å¼€å‘æ¨¡å¼è¿è¡Œçš„æ—¶å€™ï¼Œæ¯æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–ï¼Œä¸€æ¬¡æ–°çš„ compilation å°†è¢«åˆ›å»ºã€‚ compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¥½å¤šäº‹ä»¶å›è°ƒä¾›æ’ä»¶åšæ‰©å±•ã€‚é€šè¿‡ compilation å¯¹è±¡ä¹Ÿèƒ½è¯»å–åˆ° compiler å¯¹è±¡ã€‚

**å¦‚ä½•å¹¿æ’­äº‹ä»¶ï¼Ÿ**

Webpack é€šè¿‡ [Tapable](https://github.com/webpack/tapable) æ¥è¿›è¡Œäº‹ä»¶çš„å¹¿æ’­ï¼Œcompiler å’Œ compilation éƒ½ç»§æ‰¿è‡ª `tapable`ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å®ƒä»¬èº«ä¸Šè¿›è¡Œäº‹ä»¶çš„å¹¿æ’­å’Œç›‘å¬ï¼Œå®é™…ä¸Šè¿™é‡Œåº”ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¦‚ä¸‹ï¼š

```javascript
/**
 * å¹¿æ’­å‡ºäº‹ä»¶
 * event-name: äº‹ä»¶åç§°
 * params: é™„å¸¦å‚æ•°
 */
compiler.apply('event-name', params);

/**
 * ç›‘å¬åä¸º event-name çš„äº‹ä»¶ï¼Œå½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°
 * params å‚æ•°ä¸ºå¹¿æ’­äº‹ä»¶æ—¶é™„å¸¦çš„å‚æ•°
 */
compiler.plugin('event-name', function(params) {
  
})
```

**ä¸€äº›å…³é”®çš„äº‹ä»¶**

| äº‹ä»¶åç§° | ä½œç”¨ |
| ------- | ---- |
| run     | å¯åŠ¨ç¼–è¯‘ |
| watch-run | å¯ä»¥è·å–åˆ°å“ªäº›æ–‡ä»¶çš„å˜åŒ–å¯¼è‡´é‡æ–°å¯åŠ¨ä¸€æ¬¡ç¼–è¯‘ |
| seal    | æ‰€æœ‰æ¨¡å—åŠå…¶ä¾èµ–çš„æ¨¡å—éƒ½é€šè¿‡ Loader è½¬æ¢å®Œæˆåï¼Œæ ¹æ®ä¾èµ–å…³ç³»å¼€å§‹ç”Ÿæˆ Chunk |
| emit    | ä»£è¡¨æºæ–‡ä»¶å·²ç»è½¬æ¢å’Œç»„è£…å®Œæˆï¼Œè¿™é‡Œæ˜¯ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼š |
| done    | æˆåŠŸæ„å»ºå¹¶è¾“å‡ºäº†æ–‡ä»¶åï¼Œwebpack å³å°†æ¨å‡ºçš„æ—¶å€™è§¦å‘ |
| failed  | åœ¨ç¼–è¯‘å’Œè¾“å‡ºæµç¨‹ä¸­é‡åˆ°å¼‚å¸¸å¯¼è‡´ webpack é€€å‡ºæ—¶ï¼Œä¼šç›´æ¥è·³åˆ°æœ¬æ­¥éª¤ï¼Œå¯ä»¥è·å–åˆ°å…·ä½“çš„é”™è¯¯åŸå›  |

**ğŸŒŸTapable æ ¸å¿ƒæ€æƒ³**

Tapable æä¾›äº†å¾ˆå¤šçš„ hook ï¼Œä¸»è¦åˆ†ä¸ºåŒæ­¥ã€å¼‚æ­¥ã€ä¸²è¡Œã€å¹¶è¡Œç­‰ç±»å‹ï¼Œç„¶åæ¯ä¸€ä¸ª hook éƒ½ç»§æ‰¿è‡ª `Hook` ç±»ï¼Œè¯¥ `Hook` ç±»è´Ÿè´£åˆ›å»ºç®¡ç† hook çš„å®ä¾‹å¯¹è±¡hook å®ä¾‹å¯¹è±¡å­˜æ”¾äº†å‚æ•°ã€æ‹¦æˆªå™¨ã€å·²æ³¨å†Œçš„å‡½æ•°ã€æ³¨å†Œæ–¹æ³•ã€è°ƒç”¨æ–¹æ³•ç­‰ç­‰å±æ€§ï¼Œä¾›ä½¿ç”¨è€…è¿›è¡Œä½¿ç”¨ã€‚ç„¶åå½“è°ƒç”¨ call æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ `HookCodeFactory` ç±»åŠ¨æ€ç¼–è¯‘å‡ºæœ€ç»ˆæ‰§è¡Œçš„å‡½æ•°ï¼Œç„¶åé€šè¿‡è¯¥å‡½æ•°æ¥å®ç°äº‹ä»¶çš„å¹¿æ’­ã€‚



**å¸¸ç”¨Plugins**

* commons-chunk-plugin æå–å…¬å…±ä»£ç 
* uglifyjs-webpack-plugin  é€šè¿‡ uglify å‹ç¼©ä»£ç 
* web-webpack-pluginã€html-webpack-plugin ä¸ºå•é¡µé¢åº”ç”¨è¾“å‡º html
* imagemin-webpack-plugin å‹ç¼©å›¾ç‰‡æ–‡ä»¶
* extract-text-webpack-plugin æå– javascript ä¸­çš„ css ä»£ç åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­
* webpack-bundle-analyzer åˆ†æ webpack bundle å…³ç³»

## ModuleFederationï¼ˆæ¨¡å—è”é‚¦ï¼‰